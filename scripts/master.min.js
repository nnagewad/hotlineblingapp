"use strict";var hotlineBlingApp={};hotlineBlingApp.obtainInstagram=function(){var n="https://api.instagram.com/v1/",t="pantone",o="64809.ead51d4.6efb12510be948588f940f5b3333b7ee";$.ajax({url:n+"tags/"+t+"/media/recent/?access_token="+o,type:"get",dataType:"jsonp",success:function(n){var t=Math.floor(20*Math.random());console.log(t),console.log(n);var o=n.data[t].link,e=n.data[t].images.thumbnail.url;console.log("link: "+o);var i=document.createElement("img");i.crossOrigin="Anonymous",i.src="http://crossorigin.me/"+e,i.id="photo",$("#photoID").append(i)},error:function(n){console.log(n)}})},hotlineBlingApp.EnhanceColor=function(n){return n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92},hotlineBlingApp.RGBtoXY=function(n,t,o){return rNorm=n/255,gNorm=t/255,bNorm=o/255,rFinal=hotlineBlingApp.EnhanceColor(rNorm),gFinal=hotlineBlingApp.EnhanceColor(gNorm),bFinal=hotlineBlingApp.EnhanceColor(bNorm),X=.649926*rFinal+.103455*gFinal+.197109*bFinal,Y=.234327*rFinal+.743075*gFinal+.022598*bFinal,Z=0*rFinal+.053077*gFinal+1.035763*bFinal,X+Y+Z==0?0:(xFinal=X/(X+Y+Z),yFinal=Y/(X+Y+Z),console.log("x="+xFinal,"y="+yFinal),"x="+xFinal,"y="+yFinal)};var lightsEndpoint="http://192.168.0.39/api/",hueId="341f606a74cc8af9473089711f7576a",allLights="groups/1/action",light1="lights/1/state",light2="lights/2/state",light3="lights/3/state";hotlineBlingApp.philipHueLightsInfo=function(){$.ajax({url:lightsEndpoint+hueId+"/config",type:"get",dataType:"json",success:function(n){console.log(n)},error:function(n){console.log(n)}})},hotlineBlingApp.philipHueLightsOn=function(){var n={on:!0};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){alert("Lost Connection with Philips Hue")}})},hotlineBlingApp.philipHueLightsOff=function(){var n={on:!1};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){alert("Lost Connection with Philips Hue")}})},hotlineBlingApp.philipHueLightsColor=function(){var n={xy:[xFinal,yFinal]};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){alert("Lost Connection with Philips Hue")}})},hotlineBlingApp.obtainDominantColor=function(){var n=document.getElementById("photo"),t=new ColorThief,o=t.getColor(n),e="rgb("+o+")",i=o[0],r=o[1],a=o[2];console.log("r: "+i),console.log("g: "+r),console.log("b: "+a),$("#colors").css("background",e),hotlineBlingApp.RGBtoXY(i,r,a),hotlineBlingApp.philipHueLightsColor()},hotlineBlingApp.grabImageAndColor=function(){$("#photoID").empty(),hotlineBlingApp.obtainInstagram(),setTimeout(function(){hotlineBlingApp.obtainDominantColor()},1e3)},hotlineBlingApp.loop=function(){var n=100,t=5e3;for(hotlineBlingApp.philipHueLightsOn(),i=0;i<n;i++)!function(n){setTimeout(function(){$("#photoID").empty(),hotlineBlingApp.grabImageAndColor()},500+t*n)}(i)},hotlineBlingApp.audio=function(){var n=[],t="68,82,65,75,69",o=new Audio("audio/hotlineBling.mp3");$(document).keydown(function(e){n.push(e.keyCode),n.toString().indexOf(t)>=0&&($(document).unbind("keydown",arguments.callee),o.play(),$(".controls").append("<button class='pause'>Pause</button>").append("<button class='play'>Play</button>"))}),$(".controls").on("click",".pause",function(){o.pause(),$(".pause").hide(),$(".play").show()}),$(".controls").on("click",".play",function(){o.play(),$(".play").hide(),$(".pause").show()})},hotlineBlingApp.init=function(){hotlineBlingApp.audio()},$(function(){hotlineBlingApp.init()});var CanvasImage=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=n.width,this.height=this.canvas.height=n.height,this.context.drawImage(n,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(n){this.context.putImageData(n,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(n,t){var o=this.getPalette(n,5,t),e=o[0];return e},ColorThief.prototype.getPalette=function(n,t,o){"undefined"==typeof t&&(t=10),("undefined"==typeof o||1>o)&&(o=10);for(var e,i,r,a,u,l=new CanvasImage(n),c=l.getImageData(),s=c.data,p=l.getPixelCount(),h=[],g=0;p>g;g+=o)e=4*g,i=s[e+0],r=s[e+1],a=s[e+2],u=s[e+3],u>=125&&(i>250&&r>250&&a>250||h.push([i,r,a]));var f=MMCQ.quantize(h,t),v=f?f.palette():null;return l.removeCanvas(),v},!pv)var pv={map:function(n,t){var o={};return t?n.map(function(n,e){return o.index=e,t.call(o,n)}):n.slice()},naturalOrder:function(n,t){return t>n?-1:n>t?1:0},sum:function(n,t){var o={};return n.reduce(t?function(n,e,i){return o.index=i,n+t.call(o,e)}:function(n,t){return n+t},0)},max:function(n,t){return Math.max.apply(null,t?pv.map(n,t):n)}};var MMCQ=function(){function n(n,t,o){return(n<<2*l)+(t<<l)+o}function t(n){function t(){o.sort(n),e=!0}var o=[],e=!1;return{push:function(n){o.push(n),e=!1},peek:function(n){return e||t(),void 0===n&&(n=o.length-1),o[n]},pop:function(){return e||t(),o.pop()},size:function(){return o.length},map:function(n){return o.map(n)},debug:function(){return e||t(),o}}}function o(n,t,o,e,i,r,a){var u=this;u.r1=n,u.r2=t,u.g1=o,u.g2=e,u.b1=i,u.b2=r,u.histo=a}function e(){this.vboxes=new t(function(n,t){return pv.naturalOrder(n.vbox.count()*n.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function i(t){var o,e,i,r,a=1<<3*l,u=new Array(a);return t.forEach(function(t){e=t[0]>>c,i=t[1]>>c,r=t[2]>>c,o=n(e,i,r),u[o]=(u[o]||0)+1}),u}function r(n,t){var e,i,r,a=1e6,u=0,l=1e6,s=0,p=1e6,h=0;return n.forEach(function(n){e=n[0]>>c,i=n[1]>>c,r=n[2]>>c,a>e?a=e:e>u&&(u=e),l>i?l=i:i>s&&(s=i),p>r?p=r:r>h&&(h=r)}),new o(a,u,l,s,p,h,t)}function a(t,o){function e(n){var t,e,i,r,a,u=n+"1",c=n+"2",s=0;for(l=o[u];l<=o[c];l++)if(f[l]>g/2){for(i=o.copy(),r=o.copy(),t=l-o[u],e=o[c]-l,a=e>=t?Math.min(o[c]-1,~~(l+e/2)):Math.max(o[u],~~(l-1-t/2));!f[a];)a++;for(s=v[a];!s&&f[a-1];)s=v[--a];return i[c]=a,r[u]=i[c]+1,[i,r]}}if(o.count()){var i=o.r2-o.r1+1,r=o.g2-o.g1+1,a=o.b2-o.b1+1,u=pv.max([i,r,a]);if(1==o.count())return[o.copy()];var l,c,s,p,h,g=0,f=[],v=[];if(u==i)for(l=o.r1;l<=o.r2;l++){for(p=0,c=o.g1;c<=o.g2;c++)for(s=o.b1;s<=o.b2;s++)h=n(l,c,s),p+=t[h]||0;g+=p,f[l]=g}else if(u==r)for(l=o.g1;l<=o.g2;l++){for(p=0,c=o.r1;c<=o.r2;c++)for(s=o.b1;s<=o.b2;s++)h=n(c,l,s),p+=t[h]||0;g+=p,f[l]=g}else for(l=o.b1;l<=o.b2;l++){for(p=0,c=o.r1;c<=o.r2;c++)for(s=o.g1;s<=o.g2;s++)h=n(c,s,l),p+=t[h]||0;g+=p,f[l]=g}return f.forEach(function(n,t){v[t]=g-n}),e(u==i?"r":u==r?"g":"b")}}function u(n,o){function u(n,t){for(var o,e=1,i=0;s>i;)if(o=n.pop(),o.count()){var r=a(l,o),u=r[0],c=r[1];if(!u)return;if(n.push(u),c&&(n.push(c),e++),e>=t)return;if(i++>s)return}else n.push(o),i++}if(!n.length||2>o||o>256)return!1;var l=i(n),c=0;l.forEach(function(){c++});var h=r(n,l),g=new t(function(n,t){return pv.naturalOrder(n.count(),t.count())});g.push(h),u(g,p*o);for(var f=new t(function(n,t){return pv.naturalOrder(n.count()*n.volume(),t.count()*t.volume())});g.size();)f.push(g.pop());u(f,o-f.size());for(var v=new e;f.size();)v.push(f.pop());return v}var l=5,c=8-l,s=1e3,p=.75;return o.prototype={volume:function(n){var t=this;return(!t._volume||n)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var o=this,e=o.histo;if(!o._count_set||t){var i,r,a,u=0;for(i=o.r1;i<=o.r2;i++)for(r=o.g1;r<=o.g2;r++)for(a=o.b1;a<=o.b2;a++)index=n(i,r,a),u+=e[index]||0;o._count=u,o._count_set=!0}return o._count},copy:function(){var n=this;return new o(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(t){var o=this,e=o.histo;if(!o._avg||t){var i,r,a,u,c,s=0,p=1<<8-l,h=0,g=0,f=0;for(r=o.r1;r<=o.r2;r++)for(a=o.g1;a<=o.g2;a++)for(u=o.b1;u<=o.b2;u++)c=n(r,a,u),i=e[c]||0,s+=i,h+=i*(r+.5)*p,g+=i*(a+.5)*p,f+=i*(u+.5)*p;s?o._avg=[~~(h/s),~~(g/s),~~(f/s)]:o._avg=[~~(p*(o.r1+o.r2+1)/2),~~(p*(o.g1+o.g2+1)/2),~~(p*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(n){var t=this,o=n[0]>>c;return gval=n[1]>>c,bval=n[2]>>c,o>=t.r1&&o<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},e.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){for(var t=this.vboxes,o=0;o<t.size();o++)if(t.peek(o).vbox.contains(n))return t.peek(o).color;return this.nearest(n)},nearest:function(n){for(var t,o,e,i=this.vboxes,r=0;r<i.size();r++)o=Math.sqrt(Math.pow(n[0]-i.peek(r).color[0],2)+Math.pow(n[1]-i.peek(r).color[1],2)+Math.pow(n[2]-i.peek(r).color[2],2)),(t>o||void 0===t)&&(t=o,e=i.peek(r).color);return e},forcebw:function(){var n=this.vboxes;n.sort(function(n,t){return pv.naturalOrder(pv.sum(n.color),pv.sum(t.color))});var t=n[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(n[0].color=[0,0,0]);var o=n.length-1,e=n[o].color;e[0]>251&&e[1]>251&&e[2]>251&&(n[o].color=[255,255,255])}},{quantize:u}}();