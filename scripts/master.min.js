"use strict";var hotlineBlingApp={},$photoID=$("#photoID"),$philipsHue=$(".philips-hue"),$colors=$("#colors"),$body=$("body"),$owl=$(".owl"),$button=$("button"),$pause=$(".pause"),$play=$(".play"),$yolo=$(".yolo"),$off=$(".off"),loop;hotlineBlingApp.obtainInstagram=function(){var n="https://api.instagram.com/v1/",o="hotlineblingapp",t="64809.ead51d4.6efb12510be948588f940f5b3333b7ee";$.ajax({url:n+"tags/"+o+"/media/recent/?access_token="+t,type:"GET",dataType:"jsonp",success:function(n){var o=Math.floor(20*Math.random()),t=n.data[o],i=(t.link,t.images),e=(i.thumbnail.url,i.low_resolution.url),r=(i.standard_resolution.url,document.createElement("img"));r.crossOrigin="Anonymous",r.src="http://crossorigin.me/"+e,r.id="photo",$photoID.append(r)},error:function(n){console.log(n)}})},hotlineBlingApp.EnhanceColor=function(n){return n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92},hotlineBlingApp.RGBtoXY=function(n,o,t){return rNorm=n/255,gNorm=o/255,bNorm=t/255,rFinal=hotlineBlingApp.EnhanceColor(rNorm),gFinal=hotlineBlingApp.EnhanceColor(gNorm),bFinal=hotlineBlingApp.EnhanceColor(bNorm),X=.649926*rFinal+.103455*gFinal+.197109*bFinal,Y=.234327*rFinal+.743075*gFinal+.022598*bFinal,Z=0*rFinal+.053077*gFinal+1.035763*bFinal,X+Y+Z==0?0:(xFinal=X/(X+Y+Z),yFinal=Y/(X+Y+Z),"x="+xFinal,"y="+yFinal)};var lightsEndpoint="http://192.168.0.39/api/",hueId="341f606a74cc8af9473089711f7576a",allLights="groups/1/action",light1="lights/1/state",light2="lights/2/state",light3="lights/3/state";hotlineBlingApp.philipHueLightsInfo=function(){$.ajax({url:lightsEndpoint+hueId+"/config",type:"get",dataType:"json",success:function(n){console.log(n)},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsOn=function(){var n={on:!0};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log("Lights Successfully On")},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsOff=function(){var n={on:!1};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log("Lights are Successfully Off")},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsColor=function(){var n={xy:[xFinal,yFinal]};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){$philipsHue.show()}})},hotlineBlingApp.obtainDominantColor=function(){var n=document.getElementById("photo"),o=new ColorThief,t=o.getColor(n),i="rgb("+t+")",e=t[0],r=t[1],l=t[2];$button.mouseenter(function(){$(this).css("color",i)}),$button.mouseleave(function(){$(this).css("color","white")}),$colors.css("background",i),hotlineBlingApp.RGBtoXY(e,r,l),hotlineBlingApp.philipHueLightsColor()},hotlineBlingApp.grabImageAndColor=function(){$photoID.empty(),hotlineBlingApp.obtainInstagram(),setTimeout(function(){hotlineBlingApp.obtainDominantColor()},1e3)},hotlineBlingApp.interval=function(){loop=setInterval(function(){$body.addClass("lights-on"),$button.addClass("lights-on-button"),hotlineBlingApp.philipHueLightsOn(),$photoID.empty(),hotlineBlingApp.grabImageAndColor()},5e3)},hotlineBlingApp.audio=function(){var n=[],o="68,82,65,75,69",t=new Audio("audio/hotlineBling.mp3");$(document).keydown(function(i){n.push(i.keyCode),n.toString().indexOf(o)>=0&&($(document).unbind("keydown",arguments.callee),t.play(),$pause.css("display","inline-block"),$yolo.hide(),$owl.addClass("pulsing-owl"),hotlineBlingApp.interval())}),$pause.on("click",function(){t.pause(),$(this).hide(),$play.css("display","inline-block"),hotlineBlingApp.philipHueLightsOff(),clearInterval(loop)}),$play.on("click",function(){t.play(),$(this).hide(),$pause.css("display","inline-block"),hotlineBlingApp.philipHueLightsOn(),hotlineBlingApp.interval()}),$(t).bind("ended",function(){hotlineBlingApp.completeShutDown(),$play.hide(),$pause.hide(),$yolo.css("display","inline-block")})},hotlineBlingApp.yoloButton=function(){$yolo.on("click",function(){$owl.addClass("pulsing-owl"),hotlineBlingApp.interval(),$(this).hide(),$off.css("display","inline-block")})},hotlineBlingApp.offButton=function(){$off.on("click",function(){$(this).hide(),$yolo.show(),hotlineBlingApp.completeShutDown()})},hotlineBlingApp.completeShutDown=function(){clearInterval(loop),$photoID.empty(),hotlineBlingApp.philipHueLightsOff(),$colors.css("background","black"),$body.removeClass("lights-on"),$button.removeClass("lights-on-button"),$button.mouseenter(function(){$(this).css("color","black")}),$button.mouseleave(function(){$(this).css("color","#a39161")}),$owl.removeClass("pulsing-owl"),$owl.appendTo("#photoID")},hotlineBlingApp.init=function(){hotlineBlingApp.audio(),hotlineBlingApp.yoloButton(),hotlineBlingApp.offButton()},$(function(){hotlineBlingApp.init()});var CanvasImage=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=n.width,this.height=this.canvas.height=n.height,this.context.drawImage(n,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(n){this.context.putImageData(n,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(n,o){var t=this.getPalette(n,5,o),i=t[0];return i},ColorThief.prototype.getPalette=function(n,o,t){"undefined"==typeof o&&(o=10),("undefined"==typeof t||1>t)&&(t=10);for(var i,e,r,l,a,u=new CanvasImage(n),s=u.getImageData(),p=s.data,c=u.getPixelCount(),h=[],f=0;c>f;f+=t)i=4*f,e=p[i+0],r=p[i+1],l=p[i+2],a=p[i+3],a>=125&&(e>250&&r>250&&l>250||h.push([e,r,l]));var g=MMCQ.quantize(h,o),v=g?g.palette():null;return u.removeCanvas(),v},!pv)var pv={map:function(n,o){var t={};return o?n.map(function(n,i){return t.index=i,o.call(t,n)}):n.slice()},naturalOrder:function(n,o){return o>n?-1:n>o?1:0},sum:function(n,o){var t={};return n.reduce(o?function(n,i,e){return t.index=e,n+o.call(t,i)}:function(n,o){return n+o},0)},max:function(n,o){return Math.max.apply(null,o?pv.map(n,o):n)}};var MMCQ=function(){function n(n,o,t){return(n<<2*u)+(o<<u)+t}function o(n){function o(){t.sort(n),i=!0}var t=[],i=!1;return{push:function(n){t.push(n),i=!1},peek:function(n){return i||o(),void 0===n&&(n=t.length-1),t[n]},pop:function(){return i||o(),t.pop()},size:function(){return t.length},map:function(n){return t.map(n)},debug:function(){return i||o(),t}}}function t(n,o,t,i,e,r,l){var a=this;a.r1=n,a.r2=o,a.g1=t,a.g2=i,a.b1=e,a.b2=r,a.histo=l}function i(){this.vboxes=new o(function(n,o){return pv.naturalOrder(n.vbox.count()*n.vbox.volume(),o.vbox.count()*o.vbox.volume())})}function e(o){var t,i,e,r,l=1<<3*u,a=new Array(l);return o.forEach(function(o){i=o[0]>>s,e=o[1]>>s,r=o[2]>>s,t=n(i,e,r),a[t]=(a[t]||0)+1}),a}function r(n,o){var i,e,r,l=1e6,a=0,u=1e6,p=0,c=1e6,h=0;return n.forEach(function(n){i=n[0]>>s,e=n[1]>>s,r=n[2]>>s,l>i?l=i:i>a&&(a=i),u>e?u=e:e>p&&(p=e),c>r?c=r:r>h&&(h=r)}),new t(l,a,u,p,c,h,o)}function l(o,t){function i(n){var o,i,e,r,l,a=n+"1",s=n+"2",p=0;for(u=t[a];u<=t[s];u++)if(g[u]>f/2){for(e=t.copy(),r=t.copy(),o=u-t[a],i=t[s]-u,l=i>=o?Math.min(t[s]-1,~~(u+i/2)):Math.max(t[a],~~(u-1-o/2));!g[l];)l++;for(p=v[l];!p&&g[l-1];)p=v[--l];return e[s]=l,r[a]=e[s]+1,[e,r]}}if(t.count()){var e=t.r2-t.r1+1,r=t.g2-t.g1+1,l=t.b2-t.b1+1,a=pv.max([e,r,l]);if(1==t.count())return[t.copy()];var u,s,p,c,h,f=0,g=[],v=[];if(a==e)for(u=t.r1;u<=t.r2;u++){for(c=0,s=t.g1;s<=t.g2;s++)for(p=t.b1;p<=t.b2;p++)h=n(u,s,p),c+=o[h]||0;f+=c,g[u]=f}else if(a==r)for(u=t.g1;u<=t.g2;u++){for(c=0,s=t.r1;s<=t.r2;s++)for(p=t.b1;p<=t.b2;p++)h=n(s,u,p),c+=o[h]||0;f+=c,g[u]=f}else for(u=t.b1;u<=t.b2;u++){for(c=0,s=t.r1;s<=t.r2;s++)for(p=t.g1;p<=t.g2;p++)h=n(s,p,u),c+=o[h]||0;f+=c,g[u]=f}return g.forEach(function(n,o){v[o]=f-n}),i(a==e?"r":a==r?"g":"b")}}function a(n,t){function a(n,o){for(var t,i=1,e=0;p>e;)if(t=n.pop(),t.count()){var r=l(u,t),a=r[0],s=r[1];if(!a)return;if(n.push(a),s&&(n.push(s),i++),i>=o)return;if(e++>p)return}else n.push(t),e++}if(!n.length||2>t||t>256)return!1;var u=e(n),s=0;u.forEach(function(){s++});var h=r(n,u),f=new o(function(n,o){return pv.naturalOrder(n.count(),o.count())});f.push(h),a(f,c*t);for(var g=new o(function(n,o){return pv.naturalOrder(n.count()*n.volume(),o.count()*o.volume())});f.size();)g.push(f.pop());a(g,t-g.size());for(var v=new i;g.size();)v.push(g.pop());return v}var u=5,s=8-u,p=1e3,c=.75;return t.prototype={volume:function(n){var o=this;return(!o._volume||n)&&(o._volume=(o.r2-o.r1+1)*(o.g2-o.g1+1)*(o.b2-o.b1+1)),o._volume},count:function(o){var t=this,i=t.histo;if(!t._count_set||o){var e,r,l,a=0;for(e=t.r1;e<=t.r2;e++)for(r=t.g1;r<=t.g2;r++)for(l=t.b1;l<=t.b2;l++)index=n(e,r,l),a+=i[index]||0;t._count=a,t._count_set=!0}return t._count},copy:function(){var n=this;return new t(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(o){var t=this,i=t.histo;if(!t._avg||o){var e,r,l,a,s,p=0,c=1<<8-u,h=0,f=0,g=0;for(r=t.r1;r<=t.r2;r++)for(l=t.g1;l<=t.g2;l++)for(a=t.b1;a<=t.b2;a++)s=n(r,l,a),e=i[s]||0,p+=e,h+=e*(r+.5)*c,f+=e*(l+.5)*c,g+=e*(a+.5)*c;p?t._avg=[~~(h/p),~~(f/p),~~(g/p)]:t._avg=[~~(c*(t.r1+t.r2+1)/2),~~(c*(t.g1+t.g2+1)/2),~~(c*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(n){var o=this,t=n[0]>>s;return gval=n[1]>>s,bval=n[2]>>s,t>=o.r1&&t<=o.r2&&gval>=o.g1&&gval<=o.g2&&bval>=o.b1&&bval<=o.b2}},i.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){for(var o=this.vboxes,t=0;t<o.size();t++)if(o.peek(t).vbox.contains(n))return o.peek(t).color;return this.nearest(n)},nearest:function(n){for(var o,t,i,e=this.vboxes,r=0;r<e.size();r++)t=Math.sqrt(Math.pow(n[0]-e.peek(r).color[0],2)+Math.pow(n[1]-e.peek(r).color[1],2)+Math.pow(n[2]-e.peek(r).color[2],2)),(o>t||void 0===o)&&(o=t,i=e.peek(r).color);return i},forcebw:function(){var n=this.vboxes;n.sort(function(n,o){return pv.naturalOrder(pv.sum(n.color),pv.sum(o.color))});var o=n[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(n[0].color=[0,0,0]);var t=n.length-1,i=n[t].color;i[0]>251&&i[1]>251&&i[2]>251&&(n[t].color=[255,255,255])}},{quantize:a}}();