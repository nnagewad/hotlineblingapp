"use strict";var hotlineBlingApp={},$photoID=$("#photoID"),$philipsHue=$(".philips-hue"),$colors=$("#colors"),$body=$("body"),$button=$("button"),$pause=$(".pause"),$play=$(".play"),$yolo=$(".yolo"),$off=$(".off"),loop;hotlineBlingApp.obtainInstagram=function(){var n="https://api.instagram.com/v1/",t="hotlineblingapp",o="64809.ead51d4.6efb12510be948588f940f5b3333b7ee";$.ajax({url:n+"tags/"+t+"/media/recent/?access_token="+o,type:"GET",dataType:"jsonp",success:function(n){var t=Math.floor(20*Math.random()),o=n.data[t],i=(o.link,o.images),e=(i.thumbnail.url,i.low_resolution.url),r=(i.standard_resolution.url,document.createElement("img"));r.crossOrigin="Anonymous",r.src="http://crossorigin.me/"+e,r.id="photo",$photoID.append(r)},error:function(n){console.log(n)}})},hotlineBlingApp.EnhanceColor=function(n){return n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92},hotlineBlingApp.RGBtoXY=function(n,t,o){return rNorm=n/255,gNorm=t/255,bNorm=o/255,rFinal=hotlineBlingApp.EnhanceColor(rNorm),gFinal=hotlineBlingApp.EnhanceColor(gNorm),bFinal=hotlineBlingApp.EnhanceColor(bNorm),X=.649926*rFinal+.103455*gFinal+.197109*bFinal,Y=.234327*rFinal+.743075*gFinal+.022598*bFinal,Z=0*rFinal+.053077*gFinal+1.035763*bFinal,X+Y+Z==0?0:(xFinal=X/(X+Y+Z),yFinal=Y/(X+Y+Z),"x="+xFinal,"y="+yFinal)};var lightsEndpoint="http://192.168.0.39/api/",hueId="341f606a74cc8af9473089711f7576a",allLights="groups/1/action",light1="lights/1/state",light2="lights/2/state",light3="lights/3/state";hotlineBlingApp.philipHueLightsInfo=function(){$.ajax({url:lightsEndpoint+hueId+"/config",type:"get",dataType:"json",success:function(n){console.log(n)},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsOn=function(){var n={on:!0};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log("Lights Successfully On")},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsOff=function(){var n={on:!1};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log("Lights are Successfully Off")},error:function(n){$philipsHue.show()}})},hotlineBlingApp.philipHueLightsColor=function(){var n={xy:[xFinal,yFinal]};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){$philipsHue.show()}})},hotlineBlingApp.obtainDominantColor=function(){var n=document.getElementById("photo"),t=new ColorThief,o=t.getColor(n),i="rgb("+o+")",e=o[0],r=o[1],a=o[2];$button.mouseenter(function(){$(this).css("color",i)}),$button.mouseleave(function(){$(this).css("color","white")}),$colors.css("background",i),hotlineBlingApp.RGBtoXY(e,r,a),hotlineBlingApp.philipHueLightsColor()},hotlineBlingApp.grabImageAndColor=function(){$photoID.empty(),hotlineBlingApp.obtainInstagram(),setTimeout(function(){hotlineBlingApp.obtainDominantColor()},1e3)},hotlineBlingApp.interval=function(){loop=setInterval(function(){$body.addClass("lights-on"),$button.addClass("lights-on-button"),$photoID.empty(),hotlineBlingApp.grabImageAndColor()},5e3)},hotlineBlingApp.audio=function(){var n=[],t="68,82,65,75,69",o=new Audio("audio/hotlineBling.mp3");$(document).keydown(function(i){n.push(i.keyCode),n.toString().indexOf(t)>=0&&($(document).unbind("keydown",arguments.callee),o.play(),$pause.show(),$yolo.hide(),hotlineBlingApp.philipHueLightsOn(),hotlineBlingApp.interval())}),$pause.on("click",function(){o.pause(),$(this).hide(),$play.show(),hotlineBlingApp.philipHueLightsOff(),clearInterval(loop)}),$play.on("click",function(){o.play(),$(this).hide(),$pause.show(),hotlineBlingApp.philipHueLightsOn(),hotlineBlingApp.interval()}),$(o).bind("ended",function(){hotlineBlingApp.completeShutDown(),$play.hide(),$pause.hide(),$yolo.show()})},hotlineBlingApp.yoloButton=function(){$yolo.on("click",function(){hotlineBlingApp.philipHueLightsOn(),hotlineBlingApp.interval(),$(this).hide(),$off.show()})},hotlineBlingApp.offButton=function(){$off.on("click",function(){$(this).hide(),$yolo.show(),hotlineBlingApp.completeShutDown()})},hotlineBlingApp.completeShutDown=function(){clearInterval(loop),$photoID.empty(),hotlineBlingApp.philipHueLightsOff(),$colors.css("background","black"),$body.removeClass("lights-on"),$button.removeClass("lights-on-button"),$button.mouseenter(function(){$(this).css("color","black")}),$button.mouseleave(function(){$(this).css("color","#a39161")})},hotlineBlingApp.init=function(){hotlineBlingApp.audio(),hotlineBlingApp.yoloButton(),hotlineBlingApp.offButton()},$(function(){hotlineBlingApp.init()});var CanvasImage=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=n.width,this.height=this.canvas.height=n.height,this.context.drawImage(n,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(n){this.context.putImageData(n,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(n,t){var o=this.getPalette(n,5,t),i=o[0];return i},ColorThief.prototype.getPalette=function(n,t,o){"undefined"==typeof t&&(t=10),("undefined"==typeof o||1>o)&&(o=10);for(var i,e,r,a,l,u=new CanvasImage(n),p=u.getImageData(),s=p.data,h=u.getPixelCount(),c=[],f=0;h>f;f+=o)i=4*f,e=s[i+0],r=s[i+1],a=s[i+2],l=s[i+3],l>=125&&(e>250&&r>250&&a>250||c.push([e,r,a]));var g=MMCQ.quantize(c,t),v=g?g.palette():null;return u.removeCanvas(),v},!pv)var pv={map:function(n,t){var o={};return t?n.map(function(n,i){return o.index=i,t.call(o,n)}):n.slice()},naturalOrder:function(n,t){return t>n?-1:n>t?1:0},sum:function(n,t){var o={};return n.reduce(t?function(n,i,e){return o.index=e,n+t.call(o,i)}:function(n,t){return n+t},0)},max:function(n,t){return Math.max.apply(null,t?pv.map(n,t):n)}};var MMCQ=function(){function n(n,t,o){return(n<<2*u)+(t<<u)+o}function t(n){function t(){o.sort(n),i=!0}var o=[],i=!1;return{push:function(n){o.push(n),i=!1},peek:function(n){return i||t(),void 0===n&&(n=o.length-1),o[n]},pop:function(){return i||t(),o.pop()},size:function(){return o.length},map:function(n){return o.map(n)},debug:function(){return i||t(),o}}}function o(n,t,o,i,e,r,a){var l=this;l.r1=n,l.r2=t,l.g1=o,l.g2=i,l.b1=e,l.b2=r,l.histo=a}function i(){this.vboxes=new t(function(n,t){return pv.naturalOrder(n.vbox.count()*n.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function e(t){var o,i,e,r,a=1<<3*u,l=new Array(a);return t.forEach(function(t){i=t[0]>>p,e=t[1]>>p,r=t[2]>>p,o=n(i,e,r),l[o]=(l[o]||0)+1}),l}function r(n,t){var i,e,r,a=1e6,l=0,u=1e6,s=0,h=1e6,c=0;return n.forEach(function(n){i=n[0]>>p,e=n[1]>>p,r=n[2]>>p,a>i?a=i:i>l&&(l=i),u>e?u=e:e>s&&(s=e),h>r?h=r:r>c&&(c=r)}),new o(a,l,u,s,h,c,t)}function a(t,o){function i(n){var t,i,e,r,a,l=n+"1",p=n+"2",s=0;for(u=o[l];u<=o[p];u++)if(g[u]>f/2){for(e=o.copy(),r=o.copy(),t=u-o[l],i=o[p]-u,a=i>=t?Math.min(o[p]-1,~~(u+i/2)):Math.max(o[l],~~(u-1-t/2));!g[a];)a++;for(s=v[a];!s&&g[a-1];)s=v[--a];return e[p]=a,r[l]=e[p]+1,[e,r]}}if(o.count()){var e=o.r2-o.r1+1,r=o.g2-o.g1+1,a=o.b2-o.b1+1,l=pv.max([e,r,a]);if(1==o.count())return[o.copy()];var u,p,s,h,c,f=0,g=[],v=[];if(l==e)for(u=o.r1;u<=o.r2;u++){for(h=0,p=o.g1;p<=o.g2;p++)for(s=o.b1;s<=o.b2;s++)c=n(u,p,s),h+=t[c]||0;f+=h,g[u]=f}else if(l==r)for(u=o.g1;u<=o.g2;u++){for(h=0,p=o.r1;p<=o.r2;p++)for(s=o.b1;s<=o.b2;s++)c=n(p,u,s),h+=t[c]||0;f+=h,g[u]=f}else for(u=o.b1;u<=o.b2;u++){for(h=0,p=o.r1;p<=o.r2;p++)for(s=o.g1;s<=o.g2;s++)c=n(p,s,u),h+=t[c]||0;f+=h,g[u]=f}return g.forEach(function(n,t){v[t]=f-n}),i(l==e?"r":l==r?"g":"b")}}function l(n,o){function l(n,t){for(var o,i=1,e=0;s>e;)if(o=n.pop(),o.count()){var r=a(u,o),l=r[0],p=r[1];if(!l)return;if(n.push(l),p&&(n.push(p),i++),i>=t)return;if(e++>s)return}else n.push(o),e++}if(!n.length||2>o||o>256)return!1;var u=e(n),p=0;u.forEach(function(){p++});var c=r(n,u),f=new t(function(n,t){return pv.naturalOrder(n.count(),t.count())});f.push(c),l(f,h*o);for(var g=new t(function(n,t){return pv.naturalOrder(n.count()*n.volume(),t.count()*t.volume())});f.size();)g.push(f.pop());l(g,o-g.size());for(var v=new i;g.size();)v.push(g.pop());return v}var u=5,p=8-u,s=1e3,h=.75;return o.prototype={volume:function(n){var t=this;return(!t._volume||n)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var o=this,i=o.histo;if(!o._count_set||t){var e,r,a,l=0;for(e=o.r1;e<=o.r2;e++)for(r=o.g1;r<=o.g2;r++)for(a=o.b1;a<=o.b2;a++)index=n(e,r,a),l+=i[index]||0;o._count=l,o._count_set=!0}return o._count},copy:function(){var n=this;return new o(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(t){var o=this,i=o.histo;if(!o._avg||t){var e,r,a,l,p,s=0,h=1<<8-u,c=0,f=0,g=0;for(r=o.r1;r<=o.r2;r++)for(a=o.g1;a<=o.g2;a++)for(l=o.b1;l<=o.b2;l++)p=n(r,a,l),e=i[p]||0,s+=e,c+=e*(r+.5)*h,f+=e*(a+.5)*h,g+=e*(l+.5)*h;s?o._avg=[~~(c/s),~~(f/s),~~(g/s)]:o._avg=[~~(h*(o.r1+o.r2+1)/2),~~(h*(o.g1+o.g2+1)/2),~~(h*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(n){var t=this,o=n[0]>>p;return gval=n[1]>>p,bval=n[2]>>p,o>=t.r1&&o<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},i.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){for(var t=this.vboxes,o=0;o<t.size();o++)if(t.peek(o).vbox.contains(n))return t.peek(o).color;return this.nearest(n)},nearest:function(n){for(var t,o,i,e=this.vboxes,r=0;r<e.size();r++)o=Math.sqrt(Math.pow(n[0]-e.peek(r).color[0],2)+Math.pow(n[1]-e.peek(r).color[1],2)+Math.pow(n[2]-e.peek(r).color[2],2)),(t>o||void 0===t)&&(t=o,i=e.peek(r).color);return i},forcebw:function(){var n=this.vboxes;n.sort(function(n,t){return pv.naturalOrder(pv.sum(n.color),pv.sum(t.color))});var t=n[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(n[0].color=[0,0,0]);var o=n.length-1,i=n[o].color;i[0]>251&&i[1]>251&&i[2]>251&&(n[o].color=[255,255,255])}},{quantize:l}}();