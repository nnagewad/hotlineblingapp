"use strict";var hotlineBlingApp={};hotlineBlingApp.obtainInstagram=function(){var n="https://api.instagram.com/v1/",t="pantone",o="64809.ead51d4.6efb12510be948588f940f5b3333b7ee";$.ajax({url:n+"tags/"+t+"/media/recent/?access_token="+o,type:"get",dataType:"jsonp",success:function(n){var t=Math.floor(20*Math.random()),o=n.data[t],i=(o.link,o.images),e=(i.thumbnail.url,i.low_resolution.url),r=(i.standard_resolution.url,document.createElement("img"));r.crossOrigin="Anonymous",r.src="http://crossorigin.me/"+e,r.id="photo",$("#photoID").append(r)},error:function(n){console.log(n)}})},hotlineBlingApp.EnhanceColor=function(n){return n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92},hotlineBlingApp.RGBtoXY=function(n,t,o){return rNorm=n/255,gNorm=t/255,bNorm=o/255,rFinal=hotlineBlingApp.EnhanceColor(rNorm),gFinal=hotlineBlingApp.EnhanceColor(gNorm),bFinal=hotlineBlingApp.EnhanceColor(bNorm),X=.649926*rFinal+.103455*gFinal+.197109*bFinal,Y=.234327*rFinal+.743075*gFinal+.022598*bFinal,Z=0*rFinal+.053077*gFinal+1.035763*bFinal,X+Y+Z==0?0:(xFinal=X/(X+Y+Z),yFinal=Y/(X+Y+Z),console.log("x="+xFinal,"y="+yFinal),"x="+xFinal,"y="+yFinal)};var lightsEndpoint="http://192.168.2.247/api/",hueId="341f606a74cc8af9473089711f7576a",allLights="groups/1/action",light1="lights/1/state",light2="lights/2/state",light3="lights/3/state";hotlineBlingApp.philipHueLightsInfo=function(){$.ajax({url:lightsEndpoint+hueId+"/config",type:"get",dataType:"json",success:function(n){console.log(n)},error:function(n){console.log(n)}})},hotlineBlingApp.philipHueLightsOn=function(){var n={on:!0};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){console.log("Lost Connection with Philips Hue")}})},hotlineBlingApp.philipHueLightsOff=function(){var n={on:!1};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){console.log("Lost Connection with Philips Hue")}})},hotlineBlingApp.philipHueLightsColor=function(){var n={xy:[xFinal,yFinal]};$.ajax({url:lightsEndpoint+hueId+"/"+allLights,type:"put",dataType:"json",data:JSON.stringify(n),success:function(n){console.log(n)},error:function(n){console.log("Lost Connection with Philips Hue")}})},hotlineBlingApp.obtainDominantColor=function(){var n=document.getElementById("photo"),t=new ColorThief,o=t.getColor(n),i="rgb("+o+")",e=o[0],r=o[1],a=o[2];$("#colors").css("background",i),hotlineBlingApp.RGBtoXY(e,r,a),hotlineBlingApp.philipHueLightsColor()},hotlineBlingApp.grabImageAndColor=function(){$("#photoID").empty(),hotlineBlingApp.obtainInstagram(),setTimeout(function(){hotlineBlingApp.obtainDominantColor()},1e3)},hotlineBlingApp.loop=function(){var n=100,t=5e3;for(hotlineBlingApp.philipHueLightsOn(),i=0;i<n;i++)!function(n){setTimeout(function(){$("#photoID").empty(),hotlineBlingApp.grabImageAndColor()},500+t*n)}(i)},hotlineBlingApp.audio=function(){var n=[],t="68,82,65,75,69",o=new Audio("audio/hotlineBling.mp3");$(document).keydown(function(i){n.push(i.keyCode),n.toString().indexOf(t)>=0&&($(document).unbind("keydown",arguments.callee),o.play(),$(".controls").append("<button class='pause'><i class='fa fa-pause'></i></button>").append("<button class='play'><i class='fa fa-play'></i></button>"))}),$(".controls").on("click",".pause",function(){o.pause(),$(".pause").hide(),$(".play").css("display","block")}),$(".controls").on("click",".play",function(){o.play(),$(".play").hide(),$(".pause").show()})},hotlineBlingApp.init=function(){hotlineBlingApp.audio(),$(".yolo").on("click",function(){hotlineBlingApp.loop(),$(this).hide()})},$(function(){hotlineBlingApp.init()});var CanvasImage=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=n.width,this.height=this.canvas.height=n.height,this.context.drawImage(n,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(n){this.context.putImageData(n,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(n,t){var o=this.getPalette(n,5,t),i=o[0];return i},ColorThief.prototype.getPalette=function(n,t,o){"undefined"==typeof t&&(t=10),("undefined"==typeof o||1>o)&&(o=10);for(var i,e,r,a,u,l=new CanvasImage(n),s=l.getImageData(),c=s.data,p=l.getPixelCount(),h=[],f=0;p>f;f+=o)i=4*f,e=c[i+0],r=c[i+1],a=c[i+2],u=c[i+3],u>=125&&(e>250&&r>250&&a>250||h.push([e,r,a]));var g=MMCQ.quantize(h,t),v=g?g.palette():null;return l.removeCanvas(),v},!pv)var pv={map:function(n,t){var o={};return t?n.map(function(n,i){return o.index=i,t.call(o,n)}):n.slice()},naturalOrder:function(n,t){return t>n?-1:n>t?1:0},sum:function(n,t){var o={};return n.reduce(t?function(n,i,e){return o.index=e,n+t.call(o,i)}:function(n,t){return n+t},0)},max:function(n,t){return Math.max.apply(null,t?pv.map(n,t):n)}};var MMCQ=function(){function n(n,t,o){return(n<<2*l)+(t<<l)+o}function t(n){function t(){o.sort(n),i=!0}var o=[],i=!1;return{push:function(n){o.push(n),i=!1},peek:function(n){return i||t(),void 0===n&&(n=o.length-1),o[n]},pop:function(){return i||t(),o.pop()},size:function(){return o.length},map:function(n){return o.map(n)},debug:function(){return i||t(),o}}}function o(n,t,o,i,e,r,a){var u=this;u.r1=n,u.r2=t,u.g1=o,u.g2=i,u.b1=e,u.b2=r,u.histo=a}function i(){this.vboxes=new t(function(n,t){return pv.naturalOrder(n.vbox.count()*n.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function e(t){var o,i,e,r,a=1<<3*l,u=new Array(a);return t.forEach(function(t){i=t[0]>>s,e=t[1]>>s,r=t[2]>>s,o=n(i,e,r),u[o]=(u[o]||0)+1}),u}function r(n,t){var i,e,r,a=1e6,u=0,l=1e6,c=0,p=1e6,h=0;return n.forEach(function(n){i=n[0]>>s,e=n[1]>>s,r=n[2]>>s,a>i?a=i:i>u&&(u=i),l>e?l=e:e>c&&(c=e),p>r?p=r:r>h&&(h=r)}),new o(a,u,l,c,p,h,t)}function a(t,o){function i(n){var t,i,e,r,a,u=n+"1",s=n+"2",c=0;for(l=o[u];l<=o[s];l++)if(g[l]>f/2){for(e=o.copy(),r=o.copy(),t=l-o[u],i=o[s]-l,a=i>=t?Math.min(o[s]-1,~~(l+i/2)):Math.max(o[u],~~(l-1-t/2));!g[a];)a++;for(c=v[a];!c&&g[a-1];)c=v[--a];return e[s]=a,r[u]=e[s]+1,[e,r]}}if(o.count()){var e=o.r2-o.r1+1,r=o.g2-o.g1+1,a=o.b2-o.b1+1,u=pv.max([e,r,a]);if(1==o.count())return[o.copy()];var l,s,c,p,h,f=0,g=[],v=[];if(u==e)for(l=o.r1;l<=o.r2;l++){for(p=0,s=o.g1;s<=o.g2;s++)for(c=o.b1;c<=o.b2;c++)h=n(l,s,c),p+=t[h]||0;f+=p,g[l]=f}else if(u==r)for(l=o.g1;l<=o.g2;l++){for(p=0,s=o.r1;s<=o.r2;s++)for(c=o.b1;c<=o.b2;c++)h=n(s,l,c),p+=t[h]||0;f+=p,g[l]=f}else for(l=o.b1;l<=o.b2;l++){for(p=0,s=o.r1;s<=o.r2;s++)for(c=o.g1;c<=o.g2;c++)h=n(s,c,l),p+=t[h]||0;f+=p,g[l]=f}return g.forEach(function(n,t){v[t]=f-n}),i(u==e?"r":u==r?"g":"b")}}function u(n,o){function u(n,t){for(var o,i=1,e=0;c>e;)if(o=n.pop(),o.count()){var r=a(l,o),u=r[0],s=r[1];if(!u)return;if(n.push(u),s&&(n.push(s),i++),i>=t)return;if(e++>c)return}else n.push(o),e++}if(!n.length||2>o||o>256)return!1;var l=e(n),s=0;l.forEach(function(){s++});var h=r(n,l),f=new t(function(n,t){return pv.naturalOrder(n.count(),t.count())});f.push(h),u(f,p*o);for(var g=new t(function(n,t){return pv.naturalOrder(n.count()*n.volume(),t.count()*t.volume())});f.size();)g.push(f.pop());u(g,o-g.size());for(var v=new i;g.size();)v.push(g.pop());return v}var l=5,s=8-l,c=1e3,p=.75;return o.prototype={volume:function(n){var t=this;return(!t._volume||n)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var o=this,i=o.histo;if(!o._count_set||t){var e,r,a,u=0;for(e=o.r1;e<=o.r2;e++)for(r=o.g1;r<=o.g2;r++)for(a=o.b1;a<=o.b2;a++)index=n(e,r,a),u+=i[index]||0;o._count=u,o._count_set=!0}return o._count},copy:function(){var n=this;return new o(n.r1,n.r2,n.g1,n.g2,n.b1,n.b2,n.histo)},avg:function(t){var o=this,i=o.histo;if(!o._avg||t){var e,r,a,u,s,c=0,p=1<<8-l,h=0,f=0,g=0;for(r=o.r1;r<=o.r2;r++)for(a=o.g1;a<=o.g2;a++)for(u=o.b1;u<=o.b2;u++)s=n(r,a,u),e=i[s]||0,c+=e,h+=e*(r+.5)*p,f+=e*(a+.5)*p,g+=e*(u+.5)*p;c?o._avg=[~~(h/c),~~(f/c),~~(g/c)]:o._avg=[~~(p*(o.r1+o.r2+1)/2),~~(p*(o.g1+o.g2+1)/2),~~(p*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(n){var t=this,o=n[0]>>s;return gval=n[1]>>s,bval=n[2]>>s,o>=t.r1&&o<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},i.prototype={push:function(n){this.vboxes.push({vbox:n,color:n.avg()})},palette:function(){return this.vboxes.map(function(n){return n.color})},size:function(){return this.vboxes.size()},map:function(n){for(var t=this.vboxes,o=0;o<t.size();o++)if(t.peek(o).vbox.contains(n))return t.peek(o).color;return this.nearest(n)},nearest:function(n){for(var t,o,i,e=this.vboxes,r=0;r<e.size();r++)o=Math.sqrt(Math.pow(n[0]-e.peek(r).color[0],2)+Math.pow(n[1]-e.peek(r).color[1],2)+Math.pow(n[2]-e.peek(r).color[2],2)),(t>o||void 0===t)&&(t=o,i=e.peek(r).color);return i},forcebw:function(){var n=this.vboxes;n.sort(function(n,t){return pv.naturalOrder(pv.sum(n.color),pv.sum(t.color))});var t=n[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(n[0].color=[0,0,0]);var o=n.length-1,i=n[o].color;i[0]>251&&i[1]>251&&i[2]>251&&(n[o].color=[255,255,255])}},{quantize:u}}();